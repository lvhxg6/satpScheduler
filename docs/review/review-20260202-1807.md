# Review Report

## 摘要
本次为“仅文档审查”，按“尽量穷尽”方式逐段对比完整PRD与后端PRD的一致性。后端PRD覆盖了大部分核心调度逻辑，但仍存在多处缺失或相互矛盾的后端逻辑描述。由于文档体量较大，以下差异仍可能未穷尽。

## 问题清单

### 高
1) 缺失 AMR 任务命名规则，导致任务创建逻辑不完整。完整PRD明确 AMR 任务名称格式为 `{扫描类型}_{轮次标识}_{业务系统名称}`，用于搜索与溯源；后端PRD仅保留 `amr_task_name` 字段，未规定生成规则。参考：`docs/任务自动下发配置-PRD-20260129120000.md`（8.4.2 AMR任务名称格式）、`docs/任务自动下发配置-PRD-后端-20260129120000.md`（9.5 仅字段定义）。

2) “模板为空/默认模板”的后端处理规则缺失，影响任务创建参数一致性。完整PRD明确“若工具无可选模板，则 template_id 为空，使用工具内置默认模板”，并强调“有模板列表时必须选择模板”。后端PRD未在配置/校验/接口中明确该逻辑，易导致保存或下发时的校验与调用偏差。参考：`docs/任务自动下发配置-PRD-20260129120000.md`（7.1/7.2）、`docs/任务自动下发配置-PRD-后端-20260129120000.md`（3.4/11.1/11.2 未覆盖）。

3) “修改业务系统范围/资产范围”的生效规则前后矛盾，且与完整PRD不一致。完整PRD要求：业务系统范围修改时同步更新所有 pending 轮次 `target_system_ids/count`，资产范围/工具/模板在执行时实时读取最新配置；后端PRD在 4.7 也描述“更新 pending、执行时用最新配置”，但在 10.1 又写“当前轮次按原配置执行，下一轮次使用新配置”。这会直接影响调度执行的输入一致性。参考：`docs/任务自动下发配置-PRD-20260129120000.md`（4.2.7 配置生效时机说明）、`docs/任务自动下发配置-PRD-后端-20260129120000.md`（4.7 与 10.1 矛盾）。

### 中
4) 后端PRD未完整定义盲时配置的“列表结构与间隔参数”。完整PRD明确盲时配置包含“盲时列表（支持多条规则）”与“下发任务距盲时时间间隔”；后端PRD仅列出盲时类型示例，未在配置项层描述其结构化输入与约束，容易导致接口/存储结构不一致。参考：`docs/任务自动下发配置-PRD-20260129120000.md`（5.3 配置项）、`docs/任务自动下发配置-PRD-后端-20260129120000.md`（3.2/5.3 未覆盖）。

5) 任务拆分逻辑与数据模型字段语义不一致。完整PRD规定“按业务系统 + 最大资产数拆分”，同一业务系统可能生成多个任务；但后端PRD在 `auto_scan_round.total_task_count` 字段说明中写“本轮任务总数（业务系统数量）”，与拆分逻辑冲突，导致统计口径不一致。参考：`docs/任务自动下发配置-PRD-20260129120000.md`（4.2.9 任务拆分）、`docs/任务自动下发配置-PRD-后端-20260129120000.md`（9.4 total_task_count 说明）。

6) “业务系统级成功/失败”汇总规则缺失，影响状态与失败系统统计的一致性。完整PRD以“业务系统”为粒度判定 success/partial_failed/failed（如“部分业务系统任务创建失败”）；但后端PRD仅定义任务级 `success_task_count/failed_task_count`，未说明当一个业务系统拆成多个任务时如何归并到“失败业务系统数/列表”。参考：`docs/任务自动下发配置-PRD-20260129120000.md`（4.2.9 轮次最终状态判定、8.3 列表字段“失败业务系统”）、`docs/任务自动下发配置-PRD-后端-20260129120000.md`（9.4/11.3.1 未定义归并规则）。

### 低
7) “原始结果存储在 AMR 任务结果中”的数据去向描述在后端PRD缺失，可能影响与AMR的字段对接与责任边界认知。参考：`docs/任务自动下发配置-PRD-20260129120000.md`（7.3 原始结果说明）、`docs/任务自动下发配置-PRD-后端-20260129120000.md`（3.4/8.1 未说明）。

## 修改建议
1) 补充 AMR 任务名称生成规则，并说明用于检索/溯源。
2) 明确模板选择与 `template_id` 为空时的后端处理与校验规则（无模板列表则允许为空并使用默认模板）。
3) 统一“配置变更生效时机”描述，确保与完整PRD一致；明确 pending 轮次是否更新、执行时读取最新配置的范围。
4) 在盲时配置中补充“盲时列表结构 + 距盲时时间间隔”参数说明与接口输入结构。
5) 修正 `total_task_count` 语义或改为“任务总数（拆分后）”，并补充与拆分逻辑一致的计算口径。
6) 明确业务系统级的成功/失败汇总规则（多任务归并），以支撑“失败业务系统数/列表”的口径一致性。
7) 补充原始结果存储位置与AMR对接说明，减少实现理解偏差。

## 一致性校验
本次为文档对比（完整PRD vs 后端PRD），未涉及代码一致性审查。

## 风险/待确认点
- 文档较长且包含多处流程与数据口径描述，以上差异可能未穷尽。若需更严格穷尽性，建议提供“后端逻辑条目清单”或按章节提供对照基准进行逐条勾稽。
