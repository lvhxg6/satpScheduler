# Review Report

## 摘要
该PRD覆盖面广、流程细，但在通知规则与调度时序细节上仍有可实施性缺口。建议补齐通知策略与等待超时/轮次更新规则，避免执行期出现歧义。

## 问题清单
1. **P1/规则闭合性**：通知规则只覆盖“跳过/调度失败”，未说明 `partial_failed`、`cancelled`、`waiting超时` 等是否通知及通知内容，容易造成运营侧误判。参考：`docs/任务自动下发配置-PRD-20260129120000.md`。
2. **P1/恢复逻辑**：服务重启恢复中“waiting 状态剩余等待时间 = 超时时间 - (当前时间 - 轮次创建时间)”的依据是 `轮次创建时间`，但实际等待是从 `plan_start_time` 或进入 waiting 的时刻开始计时；以创建时间计算会放大或缩短等待窗口。参考：`docs/任务自动下发配置-PRD-20260129120000.md`。
3. **P2/状态流转**：状态机中描述“pending→cancelled（被立即执行取代）”，但手动触发“选择时间”场景里写的是“更新现有 pending 记录的计划执行时间”，这会改变 `round_tag`/`round_no` 规则与“取消再新建”是否一致，需明确是否复用轮次记录。参考：`docs/任务自动下发配置-PRD-20260129120000.md`。

## 修改建议
1. 增加通知策略：对 `partial_failed`、`cancelled`、`waiting超时` 等状态明确“是否通知/通知对象/模板”。
2. 修正等待超时计算起点，明确是 `waiting` 进入时间或 `plan_start_time`；同步数据表是否需要记录 `waiting_start_time`。
3. 明确“手动定时触发更新 pending”与“立即执行取消 pending”的一致性规则，说明是否复用 `round_tag/round_no` 或新建记录的原因。

## 风险/待确认点
- 通知策略不闭合可能导致运营侧遗漏异常处置窗口（如 `partial_failed` 或 `waiting` 超时场景）。参考：`docs/任务自动下发配置-PRD-20260129120000.md`。
